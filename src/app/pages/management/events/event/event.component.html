<nb-card *ngIf="event">
    <nb-card-body>
        <div class="row">
            <div class="col small mb-4">Event {{ eventToEdit.id }}</div>
        </div>
        <div class="row">
            <div class="col-md-8 overflow-auto" style="max-height: 40rem;">
                <h5 class="hover-edit" style="font-weight: 600;" *ngIf="!isEditTitle"
                    (click)="isEditTitle = true">{{ eventToEdit.title }}</h5>
                <ng-container *ngIf="isEditTitle">
                    <input nbInput fieldSize="giant" fullWidth [(ngModel)]="eventToEdit.title">
                    <ng-container [ngTemplateOutlet]="saveEditTemplate"></ng-container>
                </ng-container>
                <div class="d-flex pb-4 border-bottom">
                    <button nbButton size="small" class="text-capitalize mr-2 fileUpload">Update
                        Banners <input class="upload" (change)="uploadFile($event, 'bannerUrl')"
                            type="file" />
                    </button>
                    <button nbButton size="small" class="text-capitalize mr-2 fileUpload"> Update
                        Attachment <input class="upload" (change)="uploadFile($event, 'fileUrls')"
                            type="file" />
                    </button>
                    <button nbButton size="small" class="text-capitalize mr-2 fileUpload" (click)="isShowStatistic = !isShowStatistic"> {{ isShowStatistic ? 'Hide statistic' : 'View statistic'}}
                    </button>
                </div>
                <ng-container *ngIf="!isShowStatistic">                
                    <div class="event-content my-3">
                        <div class="d-flex justify-content-between">
                            <div class="font-weight-bold mb-1">Content</div>
                            <nb-icon *ngIf="!isEditContent" icon="edit-2" pack="eva"
                                (click)="isEditContent = true" class="hover-pointer"></nb-icon>
                        </div>
                        <div *ngIf="!isEditContent" [innerHTML]="eventToEdit.content"></div>
                        <ng-container *ngIf="isEditContent">
                            <quill-editor [(ngModel)]="eventToEdit.content"
                                [config]="editorConfig"></quill-editor>
                            <ng-container [ngTemplateOutlet]="saveEditTemplate"></ng-container>
                        </ng-container>
                    </div>
                    <div class="event-attachments my-3">
                        <div class="font-weight-bold mb-1">Attachments</div>
                        <div class="d-flex overflow-auto w-100">
                            <div class="event-bannerurl hover-pointer"
                                (click)="openDialog(eventBannerDialog, eventToEdit.bannerUrl)">
                                <nb-card style="max-width: 12rem;">
                                    <nb-card-header
                                        class="p-0 d-flex justify-content-center align-items-center"
                                        style="height: 6rem;">
                                        <img class="mh-100 mw-100" [src]="eventToEdit.bannerUrl">
                                    </nb-card-header>
                                    <nb-card-body class="p-2">
                                        <div class="text-truncate small">{{ eventToEdit.bannerUrl }}
                                        </div>
                                    </nb-card-body>
                                </nb-card>
                            </div>
                            <div class="event-fileurls ml-2 hover-pointer"
                                (click)="openDialog(eventBannerDialog, eventToEdit.fileUrls)">
                                <nb-card style="max-width: 12rem;">
                                    <nb-card-header
                                        class="p-0 d-flex justify-content-center align-items-center"
                                        style="height: 6rem;">
                                        <img *ngIf="isImageFile(eventToEdit.fileUrls)"
                                            class="mh-100 mw-100" [src]="event.fileUrls">
                                        <nb-icon *ngIf="!isImageFile(eventToEdit.fileUrls)"
                                            icon="file-text" pack="eva" class="w-50 h-50"></nb-icon>
                                    </nb-card-header>
                                    <nb-card-body class="p-2">
                                        <div class="text-truncate small">{{ eventToEdit.fileUrls }}
                                        </div>
                                    </nb-card-body>
                                </nb-card>
                            </div>
                        </div>
                    </div>
                    <div class="event-attendance-list">
                        <nb-card size="small">
                            <nb-card-header style="background-color: var(--menu-item-divider-color);" class="d-flex justify-content-between align-items-baseline">
                                <div>Participants ({{ participants.length }})</div>
                                <input class=" bg-white border" fieldSize="small" placeholder="Filter by rollnumber" nbInput (keyup)="filterParticipant($event)">
                            </nb-card-header>
                            <nb-card-body class="p-0">
                                <nb-list>
                                    <nb-list-item class="small px-4 d-block"
                                        *ngFor="let participant of filteredParticipantList; let i = index">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span>
                                                <a class="text-basic font-weight-bold" [routerLink]="['../../user', participant.user.rollnumber]">{{participant.user.name}}</a>
                                            </span>
                                            <span>{{ participant.user.rollnumber }}</span>
                                            <span>
                                                <button [disabled]="participant.checkin" nbButton (click)="openDialog(checkInDialog, participant.user.rollnumber); rollnumberToCheckIn = participant.participant" size="small">{{ participant.checkin ? "Already Checked in" : "Check in" }}</button>
                                            </span>
                                        </div>
                                        <div *ngIf="participant.checkedIn" class="font-italic">{{ participant.notes }}</div>
                                    </nb-list-item>
                                </nb-list>
                            </nb-card-body>
                        </nb-card>
                    </div>
                    <div class="event-attendance-list">
                        <nb-card size="small">
                            <nb-card-header style="background-color: var(--menu-item-divider-color);">Tasks ({{ eventToEdit.tasks.length }})</nb-card-header>
                            <nb-card-body class="p-0">
                                <nb-list>
                                    <nb-list-item *ngFor="let task of eventToEdit.tasks; let i = index" class="container py-2 px-4 hover-pointer hover-row item small border border-bottom-0"
                                        [ngClass]="{'selected-row': i === selectedIndex}" (click)="selectedTask = task; selectedIndex = i">
                                        <span class="font-weight-bold">{{ task.title ? task.title : 'Task' }}</span>
                                        <span>
                                            <nb-tag [text]="getTaskStatus(task.status)" size="tiny" appearance="outline"></nb-tag>
                                        </span>
                                        <span *ngIf="task.assignees?.length > 0">
                                            {{ task.assignees[0] ? task.assignees[0].name : 'Unassigned' }}
                                        </span>
                                        <span *ngIf="task.assignees === undefined || task.assignees === null || task.assignees?.length <= 0">N/A</span>
                                    </nb-list-item>
                                    <nb-list-item class="container border py-2 pl-3">
                                        <span class="btn-link hover-pointer" (click)="addTask()" style="font-size: .75rem;">+ Add task</span>
                                    </nb-list-item>
                                </nb-list>
                            </nb-card-body>
                        </nb-card>
                    </div>
                </ng-container>
                <ng-container *ngIf="isShowStatistic">
                    <ngx-event-statistic [event]="event" [participants]="participants"></ngx-event-statistic>
                </ng-container>
            </div>
            <div class="col-md-4 overflow-auto" style="max-height: 40rem;">
                <ng-container *ngIf="selectedTask === null; else selectedTaskTemplate">
                    <nb-select [(selected)]="eventToEdit.status" (selectedChange)="editEvent()"
                        size="small" class="d-block w-50 mb-2" filled="true"
                        [status]="event.status === 0 ? 'warning' : event.status === 1 ? 'success' : 'basic'">
                        <nb-option [value]="0">Non Public</nb-option>
                        <nb-option [value]="1">Public</nb-option>
                        <nb-option [value]="2">Draft</nb-option>
                    </nb-select>
                    <nb-card>
                        <nb-card-header>Details</nb-card-header>
                        <nb-card-body>
                            <div class="row">
                                <div class="col-md-4 small">Creator</div>
                                <div class="col-md-8 small">{{ event.creator.name }}</div>
                            </div>
                            <div class="row">
                                <div class="col-md-4 small">Leader</div>
                                <div class="col-md-8 small">{{ event.eventLeader.name }}</div>
                            </div>
                            <div class="row">
                                <div class="col-md-4 small">Start time</div>
                                <div class="col-md-8 small">{{ event.startTime | date:"MMM dd, yyyy 'at'hh:mm a" }}</div>
                            </div>
                            <div class="row">
                                <div class="col-md-4 small">Duration</div>
                                <div class="col-md-8 small">{{ durationObject.hours + ' hours ' + durationObject.minutes + ' minutes' }}</div>
                            </div>
                        </nb-card-body>
                    </nb-card>
                </ng-container>
                <ng-template #selectedTaskTemplate>
                    <ngx-task-detail [task]="selectedTask" [index]="selectedIndex"
                        (removeTask)="deleteTask($event)" (taskStatusChange)="editTaskStatus($event)"
            ></ngx-task-detail>
                </ng-template>
                
            </div>
        </div>
    </nb-card-body>
</nb-card>
<ng-template #eventBannerDialog let-data let-ref="dialogRef">
    <img *ngIf="isImageFile(data)" [src]="data">
    <iframe *ngIf="!isImageFile(data)"
        [src]="'https://docs.google.com/viewer?url=' + data + '&embedded=true' | safe:'resourceUrl'"
        height="700" width="500"></iframe>
</ng-template>
<ng-template #saveEditTemplate>
    <div class="d-flex">
        <nb-icon (click)="reset()" icon="close" pack="eva"
            class="border rounded hover-pointer"></nb-icon>
        <nb-icon (click)="editEvent(); isEditContent = false" icon="checkmark" pack="eva"
            class="border rounded hover-pointer ml-1"></nb-icon>
    </div>
</ng-template>

<ng-template #checkInDialog let-ref="dialogRef" let-data>
    <nb-card>
        <nb-card-header>Manual Check-in</nb-card-header>
        <nb-card-body>
            <div class="reason-for-manual-checkin">
                <div class="label mb-2">Reason</div>
                <nb-radio-group [(ngModel)]="reasonForManualCheckin" class="d-flex" name="reasonForManualCheckin">
                    <nb-radio class="border rounded py-2 pl-3 mr-2"
                      *ngFor="let reason of reasons"
                      [value]="reason">
                      {{ reason }}
                    </nb-radio>
                </nb-radio-group>
                <div class="label mb-2 mt-3">Check-in Method</div>
                <nb-radio-group [(ngModel)]="checkInMethod" class="d-flex" name="checkInMethod">
                    <nb-radio class="border rounded py-2 pl-3 mr-2"
                    *ngFor="let checkInMethod of checkInMethods"
                    [value]="checkInMethod">
                    {{ checkInMethod }}
                    </nb-radio>
                </nb-radio-group>
                <div class="label mb-2 mt-3">Notes</div>
                <input nbInput size="small" fullWidth [(ngModel)]="checkInNotes">
            </div>
        </nb-card-body>
        <nb-card-footer class="d-flex justify-content-center">
            <button nbButton status="danger" (click)="checkInManually(data)">Check in</button>
        </nb-card-footer>
    </nb-card>
</ng-template>